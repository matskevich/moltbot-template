name: Secret Scan

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Scan for secrets
        run: |
          echo "Scanning for secrets..."

          PATTERNS=(
            "sk-ant-[a-zA-Z0-9_-]{20,}"           # Anthropic
            "sk-proj-[a-zA-Z0-9_-]{20,}"          # OpenAI
            "gsk_[a-zA-Z0-9]{50,}"                # Groq
            "AIzaSy[a-zA-Z0-9_-]{33}"             # Google/Gemini
            "[0-9]{10}:[A-Za-z0-9_-]{35}"         # Telegram bot token
            "PRIVATE KEY-----"                     # SSH/SSL keys
          )

          FOUND=0

          for pattern in "${PATTERNS[@]}"; do
            if grep -rE "$pattern" --include="*.md" --include="*.sh" --include="*.json" --include="*.yml" . 2>/dev/null | grep -v ".github/workflows" | grep -v "check-secrets" | grep -v ".env.example"; then
              echo "Found potential secret matching: $pattern"
              FOUND=1
            fi
          done

          if [ $FOUND -eq 1 ]; then
            echo ""
            echo "Secrets detected! Replace with placeholders."
            exit 1
          fi

          echo "No secrets detected"
